generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model User {
  id            String   @id @default(uuid())
  email         String   @unique
  password      String
  firstName     String?
  lastName      String?
  accountStatus String   @default("ACTIVE") // ACTIVE, SUSPENDED, PENDING_VERIFICATION
  isAdmin       Boolean  @default(false)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  cases    PayPalCase[]
  messages ChatMessage[]
}

model PayPalCase {
  id          String  @id @default(uuid())
  title       String
  description String?

  // Intake Fields
  country            String?
  accountType        String? // PERSONAL, BUSINESS
  restrictionType    String? // TEMPORARY, PERMANENT, FUNDS_RELEASE, KYC_VERIFICATION, UNKNOWN
  freeTextReason     String? @db.Text
  transactionSummary String? @db.Text

  // Expanded Intake Questions
  hasUploadedIDBefore       Boolean?
  nameMatchesID             Boolean?
  hasHadUploadRejected      Boolean?
  sellingGoodsOrServices    String? // goods, services, none
  customerCount30Days       String?
  issuesInvoices            Boolean?
  isFirstTimeReceiving      Boolean?
  providedTrackingOrReason  Boolean?
  disputeCount90Days        String?
  deliveryComplaints        Boolean?
  whatExactlyDoYouSell      String?
  sellsProhibitedItems      Boolean?
  declaredBusiness          String?
  actualCustomerPaymentFor  String?
  hadOtherAccounts          String?
  otherPersonUsingDevice    String?
  reachedOutToPayPal        String?
  whatDidYouTellPayPal      String?  @db.Text
  changedExplanation        Boolean?
  movedFundsBetweenAccounts Boolean?
  transferredToSameDevice   Boolean?
  attemptedEarlyWithdrawal  Boolean?
  physicalLocation          String?
  usedVPN                   Boolean?
  suddenVolumeIncrease      Boolean?
  whyVolumeIncreased        String?
  viralSaleOrContract       Boolean?
  longTermInactive          Boolean?
  inactiveDuration          String?

  // Classification Results
  status                String  @default("PENDING") // PENDING, UNDER_REVIEW, RESOLVED, DISMISSED
  likelihood            String? // HIGH, MEDIUM, LOW
  fundLikelihood        String? // HIGH, MEDIUM, LOW
  recommendation        String? @db.Text
  classificationDetails String? @db.Text
  classificationViewed  Boolean @default(false)

  // Payment & Recovery
  isPaid   Boolean @default(false)
  paidPlan String? // PERSONAL, BUSINESS

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  userId String
  user   User   @relation(fields: [userId], references: [id])

  documents    UploadedDocument[]
  notes        CaseNote[]
  chatMessages ChatMessage[]
}

model CaseNote {
  id        String   @id @default(uuid())
  content   String   @db.Text
  createdAt DateTime @default(now())

  caseId String
  case   PayPalCase @relation(fields: [caseId], references: [id], onDelete: Cascade)
}

model ChatMessage {
  id            String   @id @default(uuid())
  content       String   @db.Text
  senderId      String // The user ID of the sender
  receiverId    String // The user ID of the receiver
  isAdminSender Boolean  @default(false)
  isRead        Boolean  @default(false)
  createdAt     DateTime @default(now())

  caseId String?
  case   PayPalCase? @relation(fields: [caseId], references: [id])

  userId String
  user   User   @relation(fields: [userId], references: [id])
}

model UploadedDocument {
  id        String   @id @default(uuid())
  fileName  String
  filePath  String
  fileType  String // e.g., "ID", "SELFIE", "DOCUMENT"
  createdAt DateTime @default(now())

  caseId String
  case   PayPalCase @relation(fields: [caseId], references: [id])
}
